<!doctype html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta name="format-detection" content="telephone=no"/>
    <title>Wolf</title>
    <style type="text/css">
    	p {
    		background-color: white;
    	}
		* {
			transition: all 2s;
		}
    </style>
</head>
<body>
<div id="app">
	<p v-for="p in players" @click="select(p.id)">
		<span v-if="p.identity == 'wolf' && player.identity == 'wolf'">ğŸº</span>
		<span v-else-if="player.id == p.id && p.identity == 'witch'">ğŸ§™â€â™€ï¸</span>
		<span v-else-if="player.id == p.id && p.identity == 'prophet'">ğŸ§™â€</span>
		<span v-else-if="player.id == p.id && p.identity == 'hunter'">ğŸ”«</span>
		<span v-else-if="player.id == p.id">ğŸ‘¼</span>
		<span v-else>ğŸ§”</span>
		<span v-if="p.sleep">ğŸ›Œ</span>
		{{p.name}}
		<span v-if="player.identity == 'wolf'" v-for="vote in p.votes">- {{vote.name}}ğŸ—¡</span>
		<span v-for="t in p.tickets">- ğŸ—¡</span>
		<span v-if="p.is_dead"> - â˜ ï¸</span>
		<span v-if="player.identity == 'witch' && p.is_killed_tonight"> - ğŸ—¡</span>
	</p>
	<a href="javascript:;" v-if="!player.sleep && !player.is_dead" @click="sleep">ç¡è§‰</a>
	<a href="javascript:;" v-if="player.identity == 'witch' && player.can_use_antidote && !player.is_dead" @click="antidote(1)">æ•‘ä»–</a>
	<a href="javascript:;" v-if="player.identity == 'witch' && player.can_use_antidote && !player.is_dead" @click="antidote(0)">ä¸æ•‘</a>
	<a href="javascript:;" v-if="player.identity == 'witch' && player.can_use_poison && !player.is_dead" @click="select(0)">ä¸æ¯’</a>
</div>
<script src="/vue-axios-wx.min.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script src="/app.js"></script>
<script>
var socket = io();
socket.on('connect', _ => {
	document.body.style.background = '#fff';
	setTimeout(_ => {
		var name = prompt('ä½ çš„åå­—:');
		while (!name) {
			name = prompt('ä½ çš„åå­—:');
		}
		socket.emit('name', name);
	}, 200);
});

// æ”¶åˆ°æ¶ˆæ¯
socket.on('message', message => {
	alert(message)
});

// åˆå§‹åŒ–ç©å®¶
socket.on('players', (players, player) => {
	if (players) {
		app.players = players;
	}
	if (player) {
		app.player = player;
	}
});

// é¢„è¨€å®¶è¢«å”¤é†’
socket.on('prophet', _ => {
	setTimeout(_ => {
		document.body.style.background = '#006';
	}, 2000);
});

socket.on('identity', message => {
	app.player.can_identity = false;
	alert(message);
});

// ç‹¼äººè¢«å”¤é†’
socket.on('wolf', _ => {
	setTimeout(_ => {
		document.body.style.background = '#900';
	}, 2000);
});

// å¥³å·«è¢«å”¤é†’
socket.on('witch', _ => {
	document.body.style.background = '#090';
	if (app.player.is_dead) {
		setTimeout(_ => {
			socket.emit('witch_is_dead');
		}, 2000);
	}
});

socket.on('hunter', _ => {
	document.body.style.background = '#990';
});

// ç‹¼äººè¢­å‡»ç›®æ ‡
socket.on('attack', players => {
	app.players = players;
});

//è¿›å…¥é»‘å¤œ
socket.on('night', _ => {
	app.night = true;
	document.body.style.background = '#000';
});

// å¤©äº®äº†
socket.on('light', _ => {
	app.night = false;
	document.body.style.background = '#FFF';
});

socket.on('wolf-win', _ => {
	app.player.is_dead = false;
	alert('ç‹¼äººèƒœåˆ©');
});

socket.on('human-win', _ => {
	app.player.is_dead = false;
	alert('å¥½äººèƒœåˆ©');
});
</script>
</body>
</html>